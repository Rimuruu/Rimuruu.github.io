{"version":3,"file":"Tetris-76a6f118.js","sources":["../../src/game/Tetris.svelte"],"sourcesContent":["\r\n<script>\r\n    import { onMount } from 'svelte';\r\nconst I = [\r\n\t[\r\n\t\t[0, 0, 0, 0],\r\n\t\t[1, 1, 1, 1],\r\n\t\t[0, 0, 0, 0],\r\n\t\t[0, 0, 0, 0],\r\n\t],\r\n\t[\r\n\t\t[0, 0, 1, 0],\r\n\t\t[0, 0, 1, 0],\r\n\t\t[0, 0, 1, 0],\r\n\t\t[0, 0, 1, 0],\r\n\t],\r\n\t[\r\n\t\t[0, 0, 0, 0],\r\n\t\t[0, 0, 0, 0],\r\n\t\t[1, 1, 1, 1],\r\n\t\t[0, 0, 0, 0],\r\n\t],\r\n\t[\r\n\t\t[0, 1, 0, 0],\r\n\t\t[0, 1, 0, 0],\r\n\t\t[0, 1, 0, 0],\r\n\t\t[0, 1, 0, 0],\r\n\t]\r\n];\r\n\r\nconst J = [\r\n\t[\r\n\t\t[1, 0, 0],\r\n\t\t[1, 1, 1],\r\n\t\t[0, 0, 0]\r\n\t],\r\n\t[\r\n\t\t[0, 1, 1],\r\n\t\t[0, 1, 0],\r\n\t\t[0, 1, 0]\r\n\t],\r\n\t[\r\n\t\t[0, 0, 0],\r\n\t\t[1, 1, 1],\r\n\t\t[0, 0, 1]\r\n\t],\r\n\t[\r\n\t\t[0, 1, 0],\r\n\t\t[0, 1, 0],\r\n\t\t[1, 1, 0]\r\n\t]\r\n];\r\n\r\nconst L = [\r\n\t[\r\n\t\t[0, 0, 1],\r\n\t\t[1, 1, 1],\r\n\t\t[0, 0, 0]\r\n\t],\r\n\t[\r\n\t\t[0, 1, 0],\r\n\t\t[0, 1, 0],\r\n\t\t[0, 1, 1]\r\n\t],\r\n\t[\r\n\t\t[0, 0, 0],\r\n\t\t[1, 1, 1],\r\n\t\t[1, 0, 0]\r\n\t],\r\n\t[\r\n\t\t[1, 1, 0],\r\n\t\t[0, 1, 0],\r\n\t\t[0, 1, 0]\r\n\t]\r\n];\r\n\r\nconst O = [\r\n\t[\r\n\t\t[0, 0, 0, 0],\r\n\t\t[0, 1, 1, 0],\r\n\t\t[0, 1, 1, 0],\r\n\t\t[0, 0, 0, 0],\r\n\t]\r\n];\r\n\r\nconst S = [\r\n\t[\r\n\t\t[0, 1, 1],\r\n\t\t[1, 1, 0],\r\n\t\t[0, 0, 0]\r\n\t],\r\n\t[\r\n\t\t[0, 1, 0],\r\n\t\t[0, 1, 1],\r\n\t\t[0, 0, 1]\r\n\t],\r\n\t[\r\n\t\t[0, 0, 0],\r\n\t\t[0, 1, 1],\r\n\t\t[1, 1, 0]\r\n\t],\r\n\t[\r\n\t\t[1, 0, 0],\r\n\t\t[1, 1, 0],\r\n\t\t[0, 1, 0]\r\n\t]\r\n];\r\n\r\nconst T = [\r\n\t[\r\n\t\t[0, 1, 0],\r\n\t\t[1, 1, 1],\r\n\t\t[0, 0, 0]\r\n\t],\r\n\t[\r\n\t\t[0, 1, 0],\r\n\t\t[0, 1, 1],\r\n\t\t[0, 1, 0]\r\n\t],\r\n\t[\r\n\t\t[0, 0, 0],\r\n\t\t[1, 1, 1],\r\n\t\t[0, 1, 0]\r\n\t],\r\n\t[\r\n\t\t[0, 1, 0],\r\n\t\t[1, 1, 0],\r\n\t\t[0, 1, 0]\r\n\t]\r\n];\r\n\r\nconst Z = [\r\n\t[\r\n\t\t[1, 1, 0],\r\n\t\t[0, 1, 1],\r\n\t\t[0, 0, 0]\r\n\t],\r\n\t[\r\n\t\t[0, 0, 1],\r\n\t\t[0, 1, 1],\r\n\t\t[0, 1, 0]\r\n\t],\r\n\t[\r\n\t\t[0, 0, 0],\r\n\t\t[1, 1, 0],\r\n\t\t[0, 1, 1]\r\n\t],\r\n\t[\r\n\t\t[0, 1, 0],\r\n\t\t[1, 1, 0],\r\n\t\t[1, 0, 0]\r\n\t]\r\n];\r\n\r\nconst HRB = 40;\r\nconst COL = 10;\r\nconst ROW = 20;\r\nconst SK = \"#2f1a4a\";\r\nconst  TKS = \"#8361b0\";\r\nconst PIECES = [\r\n    [Z,\"red\"],\r\n    [S,\"green\"],\r\n    [T,\"yellow\"],\r\n    [O,\"blue\"],\r\n    [L,\"purple\"],\r\n    [I,\"cyan\"],\r\n    [J,\"orange\"]\r\n];\r\nvar canvas;\r\nvar scoring;\r\nvar context ;\r\nvar torei = [];\r\nlet r;\r\nlet c;\r\nlet y;\r\nfunction getRandomInt(min, max) {\r\n  min = Math.ceil(min);\r\n  max = Math.floor(max);\r\n  return Math.floor(Math.random() * (max - min)) + min;\r\n}\r\n\r\nfor(r = 0; r <ROW; r++){\r\n    torei[r] = [];\r\n    for(c = 0; c < COL; c++){\r\n        torei[r][c] = SK;\r\n    }\r\n}\r\n\r\nfunction drawHRB(x,y,color){\r\n\tcontext.fillStyle = color;\r\n\tcontext.fillRect(x*HRB,y*HRB,HRB,HRB)\r\n\tcontext.strokeStyle = TKS;\r\n\tcontext.strokeRect(x*HRB,y*HRB,HRB,HRB)\r\n\t\r\n}\r\n\r\nfunction drawBoard(){\r\n\tfor (r = 0; r < ROW; r++) {\r\n\t\tfor (c = 0; c < COL; c++) {\r\n\t\t\tdrawHRB(c,r,torei[r][c]);\r\n\t\t}\t\r\n\t}\r\n} \r\n\r\nfunction randomPiece(){\r\n\tlet random = PIECES[getRandomInt(0,7)];\r\n\treturn new Piece(random[0],random[1])\r\n\r\n}\r\n\r\n\r\nlet p = randomPiece();\r\nlet score = 0;\r\n\r\n\r\nfunction Piece(tetro,color){\r\n\tthis.tetro = tetro;\r\n\tthis.color = color;\r\n\tthis.state = 0;\r\n\tthis.activeTetro = this.tetro[this.state];\r\n\tthis.x = 3;\r\n\tthis.y = -2;\r\n}\r\n\r\nPiece.prototype.draw = function(color){\r\n\tfor (r = 0; r < this.activeTetro.length; r++) {\r\n\t\tfor (c = 0; c < this.activeTetro.length; c++) {\r\n\t\t\tif (this.activeTetro[r][c]) {\r\n\t\t\t\tdrawHRB(this.x+c,this.y+r,color);\r\n\t\t\t}\r\n\t\t}\t\r\n\t}\r\n}\r\n\r\nPiece.prototype.in = function(){\r\n\tthis.draw(this.color);\r\n}\r\n\r\nPiece.prototype.out = function (){\r\n\tthis.draw(SK);\r\n}\r\n\r\nPiece.prototype.moveDown = function(){\r\n\tif(!this.collision(0,1,this.activeTetro)){\r\n\t\tthis.out();\r\n\t\tthis.y++;\r\n\t\tthis.in();\r\n\t}else{\r\n       \r\n        this.lock();\r\n        p = randomPiece();\r\n    }\r\n\t\r\n}\r\n\r\nPiece.prototype.moveRight = function(){\r\n    if(!this.collision(1,0,this.activeTetro)){\r\n       this.out();\r\n\t\tthis.x++;\r\n\t\tthis.in();\r\n    }\r\n}\r\n\r\n\r\nPiece.prototype.moveLeft = function(){\r\n    if(!this.collision(-1,0,this.activeTetro)){\r\n        this.out();\r\n\t\tthis.x--;\r\n\t\tthis.in();\r\n    }\r\n}\r\n\r\nPiece.prototype.rotate = function(){\r\n    let nextPattern = this.tetro[(this.state + 1)%this.tetro.length];\r\n    let kick = 0;\r\n    \r\n    if(this.collision(0,0,nextPattern)){\r\n        if(this.x > COL/2){\r\n         \r\n            kick = -1; \r\n        }else{\r\n        \r\n            kick = 1; \r\n        }\r\n    }\r\n    \r\n    if(!this.collision(kick,0,nextPattern)){\r\n        this.out();\r\n        this.x += kick;\r\n        this.state = (this.state + 1)%this.tetro.length; \r\n        this.activeTetro = this.tetro[this.state];\r\n        this.in();\r\n    }\r\n}\r\n\r\nPiece.prototype.lock = function(){\r\n    for( r = 0; r < this.activeTetro.length; r++){\r\n        for(c = 0; c < this.activeTetro.length; c++){\r\n            // we skip the vacant squares\r\n            if( !this.activeTetro[r][c]){\r\n                continue;\r\n            }\r\n \r\n            if(this.y + r < 0){\r\n                alert(\"Game Over\");\r\n                \r\n                gameOver = true;\r\n                reset();\r\n                break;\r\n                \r\n            }\r\n\r\n            torei[this.y+r][this.x+c] = this.color;\r\n        }\r\n    }\r\n    // remove full rows\r\n    for(r = 0; r < ROW; r++){\r\n        let isRowFull = true;\r\n        for( c = 0; c < COL; c++){\r\n            isRowFull = isRowFull && (torei[r][c] != SK);\r\n        }\r\n\r\n        if(isRowFull){\r\n        \r\n            for( y = r; y > 1; y--){\r\n                for( c = 0; c < COL; c++){\r\n                    torei[y][c] = torei[y-1][c];\r\n                }\r\n            }\r\n          \r\n            for( c = 0; c < COL; c++){\r\n                torei[0][c] = SK;\r\n            }\r\n       \r\n            score += 10;\r\n          \r\n        }\r\n    }\r\n \r\n    drawBoard();\r\n    \r\n   \r\n    scoring.innerHTML = \" \"+score+\" \";\r\n}\r\n\r\n\r\nPiece.prototype.collision = function(x,y,tetro){\r\n    for( r = 0; r < tetro.length; r++){\r\n        for(c = 0; c < tetro.length; c++){\r\n          \r\n            if(!tetro[r][c]){\r\n                continue;\r\n            }\r\n       \r\n            let newX = this.x + c + x;\r\n            let newY = this.y + r + y;\r\n            \r\n     \r\n            if(newX < 0 || newX >= COL || newY >= ROW){\r\n                return true;\r\n            }\r\n            \r\n            if(newY <= 0){\r\n                continue;\r\n            }\r\n           \r\n            if( torei[newY][newX] != SK){\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\ndocument.addEventListener(\"keydown\",CONTROL);\r\n\r\nfunction CONTROL(event){\r\n   \r\n    if(event.keyCode == 81){\r\n        p.moveLeft();\r\n     \r\n    }else if(event.keyCode == 90){\r\n       p.rotate();\r\n      \r\n    }else if(event.keyCode == 68){\r\n        p.moveRight();\r\n\r\n    }else if(event.keyCode == 83){\r\n        p.moveDown();\r\n    }\r\n}\r\n\r\nlet dropStart = Date.now();\r\nlet gameOver = false;\r\n\r\nfunction drop(){\r\n    let now = Date.now();\r\n    let delta = now - dropStart;\r\n    if(delta > 1000){\r\n        p.moveDown();\r\n        dropStart = Date.now();\r\n    }\r\n    if( !gameOver){\r\n        requestAnimationFrame(drop);\r\n    }\r\n   \r\n}\r\n\r\nfunction reset(){\r\n    \r\n    for( r = 0; r <ROW; r++){\r\n    torei[r] = [];\r\n    for(c = 0; c < COL; c++){\r\n        torei[r][c] = SK;\r\n    }\r\n    p = randomPiece();\r\n    gameOver = false;\r\n    score = 0;\r\n    scoring.innerHTML = \" \"+score+\" \";\r\n \r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nonMount(()=>{\r\ncontext = canvas.getContext(\"2d\");\r\n\r\ndrawBoard();\r\ndrop();\r\n\r\n\r\n\r\n})\r\n\r\n</script>\r\n<style>\r\n#help{\r\n    padding: 25px;\r\n\r\n}\r\n</style>\r\n\t<div class=\"d-flex d-inline-block\" id=\"wrap\">\r\n\r\n\t\t<div id=\"tetris\">\r\n\t\t\r\n\t\t\t<canvas bind:this={canvas} id=\"frame\" width=\"400\" height=\"800\"></canvas>\r\n\t\t\t\r\n\r\n\t\t</div>\r\n\t\t<div id=\"help\">\r\n        \t<h1 class=\"text-dark\">Score :<a bind:this={scoring}  id=\"score\"> 0 </a></h1>\r\n\t\t<h2 class=\"text-dark\" id=\"tetrist\">Controle:<br> Z=ROTATE<br> S=DOWN<br> Q=LEFT<br> D=RIGHT</h2>\r\n\t</div>\r\n\r\n</div>"],"names":["SK","PIECES","canvas","scoring","context","torei","r","c","y","drawHRB","x","color","fillStyle","fillRect","strokeStyle","strokeRect","drawBoard","randomPiece","random","min","max","Math","ceil","floor","Piece","p","score","tetro","this","state","activeTetro","prototype","draw","length","in","out","moveDown","collision","lock","moveRight","moveLeft","rotate","nextPattern","kick","COL","alert","gameOver","reset","isRowFull","innerHTML","newX","newY","document","addEventListener","event","keyCode","dropStart","Date","now","drop","requestAnimationFrame","onMount","getContext"],"mappings":"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"}